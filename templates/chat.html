<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Parea - Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Orbitron:wght@700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        :root { --gold: #D4AF37; --msg-bg: rgba(25, 25, 25, 0.9); }
        body { 
            background: #000; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
            background-attachment: fixed; background-repeat: no-repeat; transition: background 0.5s ease;
        }
        
        .header { background: rgba(0,0,0,0.92); padding: 10px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--gold); z-index: 1000; min-height: 120px; position: relative; }

        /* Î¦Î©Î¤ÎŸÎ¡Î¥Î˜ÎœÎ™ÎšÎ‘ Î£Î• ÎŸÎ›ÎŸ Î¤ÎŸ CHAT (AMBIENT DISCO) */
        .disco-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; overflow: hidden; z-index: 1;
        }
        .spot {
            position: absolute; width: 150px; height: 150px; border-radius: 50%;
            filter: blur(60px); opacity: 0.4; animation: disco-flash 0.6s infinite alternate;
        }
        /* Î¤Ï…Ï‡Î±Î¯ÎµÏ‚ Î¸Î­ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï‡ÏÏÎ¼Î±Ï„Î± */
        .spot-1 { top: 10%; left: 10%; background: #ff0000; animation-duration: 0.4s; }
        .spot-2 { top: 20%; right: 15%; background: #00ff00; animation-duration: 0.7s; }
        .spot-3 { bottom: 20%; left: 20%; background: #0000ff; animation-duration: 0.5s; }
        .spot-4 { bottom: 10%; right: 10%; background: #ffff00; animation-duration: 0.3s; }
        .spot-5 { top: 50%; left: 40%; background: #ff00ff; animation-duration: 0.8s; }
        .spot-6 { top: 40%; right: 40%; background: #00ffff; animation-duration: 0.4s; }

        @keyframes disco-flash {
            0% { transform: scale(0.8); opacity: 0.1; }
            100% { transform: scale(1.3); opacity: 0.5; }
        }

        /* HEADER & DJ ELEMENTS */
        #sonic_dj { font-family: 'Orbitron'; color: #FFD700; text-shadow: 0 0 10px #ff4500, 0 0 20px #ff0000; animation: burn 1.5s infinite alternate; font-weight: bold; }
        @keyframes burn { from { transform: scale(1); } to { transform: scale(1.05); } }

        #dj_profile img { 
            width: 85px !important; height: 85px !important; border-radius: 50% !important; 
            border: 3px solid var(--gold) !important; object-fit: contain !important;
            background: #111; box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .player-container { background: rgba(212, 175, 55, 0.1); padding: 15px 25px; border-radius: 50px; border: 1px solid rgba(212, 175, 55, 0.4); display: flex; align-items: center; gap: 15px; position: relative; z-index: 1005; }
        
        .main { display: flex; flex: 1; overflow: hidden; position: relative; }
        #chat-window { flex: 1; display: flex; flex-direction: column; background: rgba(0,0,0,0.4); position: relative; backdrop-filter: blur(3px); }
        
        /* CHAT BOX - Î Î¡Î•Î Î•Î™ ÎÎ‘ Î•Î™ÎÎ‘Î™ Î Î‘ÎÎ© Î‘Î ÎŸ Î¤Î‘ Î¦Î©Î¤ÎŸÎ¡Î¥Î˜ÎœÎ™ÎšÎ‘ */
        #chat-box { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 12px; z-index: 10; position: relative; }
        .message { background: var(--msg-bg); padding: 12px 18px; border-radius: 18px; border-left: 5px solid var(--gold); align-self: flex-start; max-width: 85%; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        
        .sidebar { width: 190px; background: rgba(0,0,0,0.9); border-left: 2px solid var(--gold); padding-top: 20px; text-align: center; overflow-y: auto; z-index: 20; }

        .input-area { background: #000; padding: 15px; border-top: 2px solid var(--gold); z-index: 30; }
        #chat-input { 
            flex: 1; padding: 15px; border-radius: 20px; border: 1px solid var(--gold); 
            background: #111; color: white; outline: none; min-height: 20px; max-height: 100px;
            overflow-y: auto; cursor: text; white-space: pre-wrap;
        }
        #chat-input:empty:before { content: attr(placeholder); color: #666; font-style: italic; }

        .toolbar { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .tool-btn { background: rgba(212,175,55,0.1); border: 1px solid var(--gold); color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
        .tool-btn.active { background: var(--gold); color: #000; }
        
        .holiday-wishes { background: rgba(139, 0, 0, 0.8); color: white; padding: 5px 0; font-family: 'Dancing Script'; border-top: 1px solid var(--gold); overflow: hidden; z-index: 25; }
    </style>
</head>
<body>
    <div class="header">
        <div style="display:flex; flex-direction:column; gap:8px; position:relative; z-index:1010;">
            <button onclick="document.getElementById('setModal').style.display='block'" class="tool-btn"><i class="fas fa-user-edit"></i></button>
            <a href="{{ url_for('logout') }}" class="tool-btn" style="color:#ff4d4d; border-color:#ff4d4d; text-decoration:none; text-align:center;"><i class="fas fa-power-off"></i></a>
        </div>
        
        <div class="player-container">
            <button id="play-pause-btn" style="background:var(--gold); border:none; width:50px; height:50px; border-radius:50%; cursor:pointer;"><i class="fas fa-play" id="play-icon"></i></button>
            <div style="text-align: left;">
                <div style="font-family:'Dancing Script'; font-size:1.6em; color:white;">Radio Parea <span id="sonic_dj"></span></div>
                <div id="sonic_title" style="font-size:0.85em; color:#ddd; font-weight:bold;">Î£Ï…Î½Ï„Î¿Î½Î¹ÏƒÏ„ÎµÎ¯Ï„Îµ...</div>
            </div>
            <input type="range" id="volume" min="0" max="1" step="0.1" value="0.5" style="width:60px; accent-color:var(--gold);">
        </div>

        <div style="text-align:center; position:relative; z-index:1010;">
            <div id="dj_profile"></div>
            <div style="color:var(--gold); font-weight:bold; font-size:0.85em; margin-top:5px;">LISTENERS: <span id="sonic_listeners">0</span></div>
        </div>
    </div>

    <div class="main">
        <div id="chat-window">
            <div class="disco-bg">
                <div class="spot spot-1"></div>
                <div class="spot spot-2"></div>
                <div class="spot spot-3"></div>
                <div class="spot spot-4"></div>
                <div class="spot spot-5"></div>
                <div class="spot spot-6"></div>
            </div>

            <div id="chat-box">
                {% for msg in history %}
                <div class="message">
                    <div style="color:{{msg.author.color}}; font-weight:bold;">{{msg.author.display_name}}</div>
                    <div class="content history-content" data-raw="{{msg.content}}" style="color:{{msg.text_color or '#fff'}}"></div>
                </div>
                {% endfor %}
            </div>

            <div class="holiday-wishes">
                <marquee scrollamount="5">ğŸ„ ÎšÎ±Î»Î¬ Î§ÏÎ¹ÏƒÏ„Î¿ÏÎ³ÎµÎ½Î½Î±! ğŸ Î¥Î³ÎµÎ¯Î±, Î‘Î³Î¬Ï€Î· ÎºÎ±Î¹ Î Î¿Î»Î»Î® ÎœÎ¿Ï…ÏƒÎ¹ÎºÎ®! ğŸ¥‚ ÎšÎ±Î»Î® Î§ÏÎ¿Î½Î¹Î¬! â„ï¸âœ¨</marquee>
            </div>

            <div class="input-area">
                <div class="toolbar">
                    <button id="btn-bold" class="tool-btn" onclick="execCmd('bold', 'btn-bold')"><i class="fas fa-bold"></i></button>
                    <button id="btn-italic" class="tool-btn" onclick="execCmd('italic', 'btn-italic')"><i class="fas fa-italic"></i></button>
                    <select id="font-size" onchange="document.execCommand('fontSize', false, this.value)" style="background:#1a1a1a; color:white; border:1px solid var(--gold); border-radius:5px; padding:5px;">
                        <option value="3">ÎœÎµÏƒÎ±Î¯Î±</option>
                        <option value="2">ÎœÎ¹ÎºÏÎ¬</option>
                        <option value="5">ÎœÎµÎ³Î¬Î»Î±</option>
                    </select>
                    <input type="color" id="text-color" onchange="document.execCommand('foreColor', false, this.value)" value="#ffffff" style="width:35px; height:35px; border:none; background:none; cursor:pointer;">
                    {% if current_user.role == 'owner' %}
                        <button class="tool-btn" onclick="clearChat()" style="margin-left:auto; color:#ff4d4d;"><i class="fas fa-broom"></i></button>
                    {% endif %}
                </div>

                <div style="display:flex; gap:10px; align-items: flex-end;">
                    <div id="chat-input" contenteditable="true" placeholder="Î ÎµÏ‚ ÎºÎ¬Ï„Î¹ ÏƒÏ„Î·Î½ Ï€Î±ÏÎ­Î±... ğŸ„"></div>
                    <button onclick="sendMessage()" style="background:var(--gold); border:none; padding:12px 25px; border-radius:20px; font-weight:bold; cursor:pointer; height:45px;">Î£Î¤Î•Î™Î›Î•</button>
                </div>
            </div>
        </div>
        <div class="sidebar">
            <div style="color:var(--gold); font-weight:bold; margin-bottom:15px;">ONLINE</div>
            <div id="user-list-content"></div>
        </div>
    </div>

    <div id="setModal" style="display:none;" class="modal">
        <div style="background:#111; margin:10% auto; padding:30px; border:1px solid var(--gold); width:320px; border-radius:25px; text-align:center;">
            <h3 style="color:var(--gold);">Î Î¡ÎŸÎ¦Î™Î›</h3>
            <input type="text" id="new-avatar" placeholder="Avatar URL" style="width:90%; padding:10px; margin-bottom:10px; background:#222; color:white; border:1px solid #444;">
            <input type="color" id="new-color" style="width:100%; height:40px; border:none; cursor:pointer; margin-bottom:15px;">
            <button onclick="saveSettings()" style="background:var(--gold); border:none; padding:12px; width:100%; font-weight:bold; border-radius:10px; cursor:pointer;">Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î—</button>
            <button onclick="document.getElementById('setModal').style.display='none'" style="background:none; color:gray; border:none; cursor:pointer; margin-top:10px;">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
        </div>
    </div>

    <script id='sonic_js' data-port='8050' src='https://or.mysonicserver.com/cp/widgets.js?r=381'></script>

    <script>
        const socket = io();
        const chatInput = document.getElementById('chat-input');
        const chatBox = document.getElementById('chat-box');

        function execCmd(cmd, btnId) {
            document.execCommand(cmd, false, null);
            document.getElementById(btnId).classList.toggle('active');
            chatInput.focus();
        }

        function sendMessage() {
            const htmlContent = chatInput.innerHTML.trim();
            if (htmlContent) {
                socket.emit('message', { content: htmlContent });
                chatInput.innerHTML = '';
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            }
        }

        chatInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
        });

        socket.on('message', (msg) => {
            if(msg.content === 'CLEAN_EVENT') { chatBox.innerHTML = ''; return; }
            const div = document.createElement('div');
            div.className = 'message';
            div.innerHTML = `<b style="color:${msg.color}">${msg.display_name}</b><br><span>${msg.content}</span>`;
            chatBox.appendChild(div); chatBox.scrollTop = chatBox.scrollHeight;
        });

        const radio = new Audio('https://or.mysonicserver.com:8050/;');
        document.getElementById('play-pause-btn').onclick = () => {
            if (radio.paused) { radio.play(); document.getElementById('play-icon').className='fas fa-pause'; }
            else { radio.pause(); document.getElementById('play-icon').className='fas fa-play'; }
        };

        function createSnow() {
            const snow = document.createElement('div');
            snow.innerHTML = 'â„ï¸';
            snow.style.cssText = `position:absolute; top:-30px; left:${Math.random()*100}%; font-size:${Math.random()*10+10}px; color:white; pointer-events:none; z-index:5;`;
            document.getElementById('chat-window').appendChild(snow);
            snow.animate([{transform:'translateY(0)'}, {transform:`translateY(${window.innerHeight}px)`, opacity:0}], {duration: 5000}).onfinish = () => snow.remove();
        }
        setInterval(createSnow, 450);

        function clearChat() { if(confirm("Î£ÎºÎ¿ÏÏ€Î±;")) socket.emit('clear_chat_request'); }

        socket.on('user_list', (users) => {
            document.getElementById('user-list-content').innerHTML = users.map(u => `
                <div style="margin-bottom:15px;">
                    <img src="${u.avatar_url || 'https://ui-avatars.com/api/?name='+u.display_name}" style="width:55px; height:55px; border-radius:50%; border:3px solid ${u.color}; object-fit:cover;">
                    <div style="color:${u.color}; font-size:0.8em; font-weight:bold;">${u.display_name}</div>
                </div>`).join('');
        });

        function saveSettings() {
            socket.emit('update_profile', { color: document.getElementById('new-color').value, avatar_url: document.getElementById('new-avatar').value });
            document.getElementById('setModal').style.display = 'none';
        }

        window.onload = () => { chatBox.scrollTop = chatBox.scrollHeight; };
    </script>
</body>
</html>