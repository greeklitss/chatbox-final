<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Parea - Crystal Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@300;400;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <style>
        :root {
            --gold: #D4AF37;
            --silver: #C0C0C0;
            --platinum: #E5E4E2;
            --primary-accent: #C0392B;
        }

        body { 
            margin: 0; font-family: 'Roboto', sans-serif; 
            /* Œ¶œåŒΩœÑŒø: ŒöœÅœçœÉœÑŒ±ŒªŒªŒø Œ∫Œ±Œπ Œ∫Œ±Œ∏Œ±œÅŒÆ ŒµŒπŒ∫œåŒΩŒ± */
            background: url("{{ url_for('static', filename='radioparea_background.jpg') }}") no-repeat center center fixed; 
            background-size: cover;
            color: #FFFFFF; height: 100vh; overflow: hidden;
            position: relative;
        }

        /* --- Œ¶Œ©Œ§ŒüŒ°Œ•ŒòŒúŒôŒöŒü ŒïŒ¶Œï (Ambient Glow) --- */
        body::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(255,0,0,0.1), rgba(0,0,255,0.1), rgba(0,255,0,0.1));
            z-index: -1; animation: disco 8s linear infinite; pointer-events: none;
        }
        @keyframes disco {
            0% { filter: hue-rotate(0deg); opacity: 0.3; }
            50% { opacity: 0.6; }
            100% { filter: hue-rotate(360deg); opacity: 0.3; }
        }

        /* --- TICKER --- */
        .ticker-wrap {
            width: 100%; overflow: hidden; background: rgba(0, 0, 0, 0.85);
            border-bottom: 1px solid var(--gold); padding: 6px 0;
        }
        .ticker {
            display: inline-block; white-space: nowrap; padding-left: 100%;
            animation: ticker 35s linear infinite; font-family: 'Orbitron', sans-serif;
            font-size: 0.85em; color: var(--gold);
        }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- PLAYER BAR --- */
        .player-bar { 
            height: 75px; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(12px);
            display: flex; align-items: center; justify-content: space-between; 
            padding: 0 25px; border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        /* --- LAYOUT --- */
        .main-container { display: flex; height: calc(100vh - 110px); }
        #chat-column { flex: 1; display: flex; flex-direction: column; background: rgba(0, 0, 0, 0.15); }
        #sidebar { 
            width: 280px; background: rgba(0, 0, 0, 0.75); 
            backdrop-filter: blur(20px); border-left: 1px solid rgba(255,255,255,0.1);
        }

        /* --- MESSAGES (Clean & Crystal) --- */
        #messages { 
            flex: 1; overflow-y: auto; padding: 25px; 
            display: flex; flex-direction: column; gap: 6px;
            text-shadow: 2px 2px 5px rgba(0,0,0,1); /* ŒìŒπŒ± Œ±œÄœåŒªœÖœÑŒ∑ Œ∫Œ±Œ∏Œ±œÅœåœÑŒ∑œÑŒ± Œ∫ŒµŒπŒºŒ≠ŒΩŒøœÖ */
        }
        .message-line { font-size: 1.15em; line-height: 1.5; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .user-name { font-weight: 700; margin-right: 10px; }

        /* --- INPUT AREA --- */
        .input-area { padding: 20px; background: rgba(0, 0, 0, 0.8); border-top: 1px solid rgba(255,255,255,0.1); }
        .tool-bar { display: flex; gap: 20px; margin-bottom: 12px; color: #ddd; font-size: 1.3em; }
        .tool-bar i { cursor: pointer; transition: 0.3s; }
        .tool-bar i:hover { color: var(--gold); transform: translateY(-3px); }

        #message-input { 
            width: 100%; padding: 14px 22px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.08); color: white; outline: none; font-size: 1em;
        }

        /* --- SETTINGS --- */
        #settings-menu {
            display: none; position: absolute; top: 115px; right: 20px;
            background: #111; border: 1px solid var(--gold); border-radius: 10px; padding: 10px; z-index: 1000;
        }
        .set-link { color: white; text-decoration: none; display: block; padding: 10px 15px; }
        .set-link:hover { background: var(--primary-accent); border-radius: 5px; }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    </style>
</head>
<body>

    <div class="ticker-wrap">
        <div class="ticker">
            üéôÔ∏è ON AIR: <span id="t_dj">...</span> | üéµ TRACK: <span id="t_title">Radio Parea Live</span> | üë• PAREA: <span id="t_listeners">0</span>
        </div>
    </div>

    <div class="player-bar">
        <div style="font-family: 'Dancing Script', cursive; color: var(--gold); font-size: 1.8em; text-shadow: 0 0 10px var(--gold);">Radioparea Studio</div>
        
        <audio id="radio-player" crossorigin="anonymous">
            <source src="https://or.mysonicserver.com:8050/stream" type="audio/mpeg">
        </audio>

        <div style="display:flex; align-items:center; gap:25px;">
            <button onclick="togglePlay()" id="play-btn" style="background:none; border:none; color:var(--gold); font-size: 3.2em; cursor:pointer;">
                <i class="fas fa-play-circle"></i>
            </button>
            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" style="width:90px; cursor:pointer;">
            <i class="fas fa-cog" onclick="toggleSettings()" style="cursor:pointer; font-size: 1.4em; color: white;"></i>
        </div>
    </div>

    <div id="settings-menu">
        <a href="/logout" class="set-link"><i class="fas fa-sign-out-alt"></i> ŒëœÄŒøœÉœçŒΩŒ¥ŒµœÉŒ∑</a>
    </div>

    <div class="main-container">
        <div id="chat-column">
            <div id="messages">
                {% for msg in messages %}
                <div class="message-line">
                    <span class="user-name" data-user="{{ msg.author.display_name }}">{{ msg.author.display_name }}:</span>
                    <span>{{ msg.content | safe }}</span>
                </div>
                {% endfor %}
            </div>

            <div class="input-area">
                <div class="tool-bar">
                    <i class="far fa-smile" title="Emojis"></i>
                    <i class="fas fa-bolt" title="Trending GIFs"></i>
                    <i class="fas fa-image" title="Photos"></i>
                </div>
                <input type="text" id="message-input" placeholder="ŒìœÅŒ¨œàŒµ Œ∫Œ¨œÑŒπ œÉœÑŒ∑ŒΩ œÄŒ±œÅŒ≠Œ±..." autocomplete="off">
            </div>
        </div>

        <div id="sidebar">
            <div style="padding:20px; font-family:'Dancing Script'; color:var(--gold); font-size:1.6em; border-bottom:1px solid rgba(255,255,255,0.1); text-align:center;">Online Parea</div>
            <div id="user-list" style="padding:20px; overflow-y:auto; flex:1;"></div>
        </div>
    </div>

    <div style="display:none;"><span id="sonic_dj"></span><span id="sonic_title"></span><span id="sonic_listeners"></span></div>
    <script id='sonic_js' data-port='8050' src='https://or.mysonicserver.com/cp/widgets.js?r=381'></script>

    <script>
        const socket = io();
        const msgInput = document.getElementById('message-input');
        const userColors = {};

        // --- GOLD, SILVER, PLATINUM & PASTELS ---
        function getUserColor(name) {
            if (userColors[name]) return userColors[name];
            const palette = [
                '#D4AF37', '#FFD700', '#F9A602', // Gold shades
                '#C0C0C0', '#E5E4E2', '#BCC6CC', // Silver/Platinum
                '#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7', '#C7CEEA', // Pastels
                '#FAD0C4', '#FBC2EB', '#A1C4FD', '#96E6A1', '#D4FC79'
            ];
            let hash = 0;
            for (let i = 0; i < name.length; i++) { hash = name.charCodeAt(i) + ((hash << 5) - hash); }
            const finalColor = palette[Math.abs(hash) % palette.length];
            userColors[name] = finalColor;
            return finalColor;
        }

        // Apply colors to existing
        document.querySelectorAll('.user-name').forEach(el => {
            el.style.color = getUserColor(el.getAttribute('data-user'));
        });

        msgInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && msgInput.value.trim()) {
                socket.emit('message', {content: msgInput.value});
                msgInput.value = '';
            }
        });

        socket.on('message', (data) => {
            const div = document.createElement('div');
            div.className = 'message-line';
            const color = getUserColor(data.display_name);
            div.innerHTML = `<span class="user-name" style="color:${color}">${data.display_name}:</span><span>${data.content}</span>`;
            const box = document.getElementById('messages');
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });

        socket.on('users_update', (users) => {
            document.getElementById('user-list').innerHTML = users.map(u => 
                `<div style="color:${getUserColor(u.display_name)}; margin-bottom:12px; font-weight:bold; font-size:0.95em;">‚óè ${u.display_name}</div>`
            ).join('');
        });

        // --- RADIO CONTROL ---
        const radio = document.getElementById('radio-player');
        function togglePlay() {
            if (radio.paused) {
                radio.load(); radio.play();
                document.getElementById('play-btn').innerHTML = '<i class="fas fa-pause-circle"></i>';
            } else {
                radio.pause();
                document.getElementById('play-btn').innerHTML = '<i class="fas fa-play-circle"></i>';
            }
        }
        document.getElementById('volume-slider').oninput = (e) => { radio.volume = e.target.value; };

        function toggleSettings() {
            const m = document.getElementById('settings-menu');
            m.style.display = m.style.display === 'block' ? 'none' : 'block';
        }

        setInterval(() => {
            document.getElementById('t_dj').innerText = document.getElementById('sonic_dj').innerText || 'Auto DJ';
            document.getElementById('t_title').innerText = document.getElementById('sonic_title').innerText || 'Radio Parea Live';
            document.getElementById('t_listeners').innerText = document.getElementById('sonic_listeners').innerText.replace(/\D/g,'') || '0';
        }, 3000);
    </script>
</body>
</html>