<!DOCTYPE html>
<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <title>AkoY Me</title>
	
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
 
    /* ğŸš¨ ÎŸÎ¡Î™Î£Î¤Î™ÎšÎ— Î”Î™ÎŸÎ¡Î˜Î©Î£Î— Î“Î™Î‘ Î”Î™Î‘Î¦Î‘ÎÎ•Î™Î‘ (Transparency Fixes) */
    
    /* 1. Î“Î¹Î± Ï„Î· Î»Î¯ÏƒÏ„Î± Ï„Ï‰Î½ online Ï‡ÏÎ·ÏƒÏ„ÏÎ½ */
    /* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: #user-list-panel */
    #online-list, .online-users-container, .sidebar, #user-list-panel { 
        background: none !important; /* ÎšÎ¬Î½ÎµÎ¹ Ï„Î¿ Ï†ÏŒÎ½Ï„Î¿ Î´Î¹Î±Ï†Î±Î½Î­Ï‚ */
        border: none !important;     /* Î‘Ï†Î±Î¹ÏÎµÎ¯ Ï„Ï…Ï‡ÏŒÎ½ Ï€ÎµÏÎ¹Î³ÏÎ¬Î¼Î¼Î±Ï„Î± */
        box-shadow: none !important;
    }
    
    /* 2. Î“Î¹Î± Ï„Î¿Î½ player/Ï‡ÏÎ®ÏƒÏ„Î· (Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Ï„Î¿Ï… ÏƒÎºÎ¿ÏÏÎ¿Ï… Ï†ÏŒÎ½Ï„Î¿Ï…) */
    /* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: #header ÎºÎ±Î¹ #radio-player-container */
    .player-container, .user-info-panel, .chat-header, #header, #radio-player-container {
        background: none !important;
        border: none !important;
        box-shadow: none !important;
    }
  
        /* --- GLOBAL & STRUCTURE --- */ 
        :root { 
            --primary-accent: #FF0066; /* Hot Pink/Magenta (Neon) */ 
            --secondary-accent: #39FF14; /* Neon Green */ 
            --text-color: #F0F0F0; 
            --link-color: #64FFDA;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212;
            color: var(--text-color);
            margin: 0;
            padding-top: 120px; 
            background-image: url("{{ url_for('static', filename='akoyme_background.png') }}"); 
            background-size: cover; 
            background-attachment: fixed; 
            background-position: center;
            height: 100vh;
            overflow: hidden; 
        }
        
        .container {
            width: 100%; 
            height: calc(100% - 140px); 
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* --- HEADER & RADIO PLAYER STYLES --- */
        #header { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            background-color: rgba(20, 20, 20, 0.95); 
            padding: 10px 20px; 
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            z-index: 20; 
            border-bottom: 1px solid var(--primary-accent); 
            height: 50px; 
            box-sizing: border-box; 
        }

	#radio-player-container {
        position: fixed; 
        top: 50px; 
        left: 0;
        width: 100%;
        height: 65px; 
        background-color: rgba(0, 0, 0, 0.9); 
        z-index: 1000; 
        padding: 5px 0; 
        box-sizing: border-box;
        border-bottom: 2px solid var(--primary-accent);
        
        display: flex;
        flex-direction: column;
        align-items: center; 
        justify-content: center;
    }
    
    /* Styling Î³Î¹Î± Ï„Î¿ Audio Player */
    #audio-stream {
        width: 90%; 
        /* Î ÎµÎ¹ÏÎ±Î¼Î±Ï„Î¹ÎºÏŒ: Î”Î¿ÎºÎ¹Î¼Î® Ï‡ÏÏ‰Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï */
        filter: invert(1) hue-rotate(180deg) saturate(3); 
        border: 1px solid var(--secondary-accent);
        background-color: #333; 
        border-radius: 4px;
        box-shadow: 0 0 5px var(--secondary-accent);
    }

    .radio-metadata {
        width: 90%; 
        height: 30px; 
        margin-top: 5px; 
        overflow: hidden; 
        white-space: nowrap; 
        border: 1px solid var(--secondary-accent); 
        box-shadow: 0 0 5px var(--secondary-accent);
        text-align: center; 
        line-height: 30px; 
        background-color: rgba(0, 0, 0, 0.5); 
    }

    .metadata-text {
        color: var(--secondary-accent); 
        font-size: 1.0em; 
        font-weight: bold;
        display: inline-block;
    }

    #header h1 { 
        margin: 0; 
        color: var(--secondary-accent); 
        font-size: 1.5em; 
        text-shadow: 0 0 5px rgba(57, 255, 20, 0.5); 
    }

    .role-owner { 
        color: #FFD700; 
        font-weight: bold;
        text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); 
    }
        
    #chat-container {
        margin-right: 250px; 
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    #user-list-panel {
        position: fixed;
        top: 125px; 
        right: 20px;
        width: 220px;
        height: calc(100vh - 150px); 
        background-color: #1f1f1f;
        border: 1px solid #333;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        padding: 10px;
        overflow-y: auto;
        z-index: 10;
    }

    #chatbox {
        flex-grow: 1;
        overflow-y: auto;
        padding: 10px;
        background-color: transparent; 
        border-radius: 8px;
        margin-bottom: 10px;
    }
        
    #input-area {
        display: flex;
        padding: 10px;
        margin-right: 250px; 
        background-color: rgba(20, 20, 20, 0.8);
        position: fixed;
        bottom: 0;
        left: 0;
        width: calc(100% - 250px); 
        box-sizing: border-box;
        border-top: 1px solid var(--primary-accent);
    }
    
    /* Styles for buttons and input area */
    #input-area button, #header button {
        background-color: #333;
        color: var(--primary-accent);
        border: 1px solid var(--primary-accent);
        padding: 8px 12px;
        margin: 0 5px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s, box-shadow 0.3s;
    }

    #message-input {
        flex-grow: 1;
        padding: 8px;
        border: 1px solid #555;
        border-radius: 5px;
        background-color: #2b2b2b;
        color: var(--text-color);
        resize: none;
        box-sizing: border-box;
        margin-right: 5px;
    }
    </style>
</head>

<body>
    
    <header id="header">
        <h1>AkoY Me</h1>
        <div id="user-info">
            <div id="user-actions">
                <button id="settings-button" title="Settings" style="margin-left: 10px;" onclick="document.getElementById('settings-modal').style.display='block';"><i class="fas fa-cog"></i></button>
                
                <button id="admin-button" style="display: none; margin-left: 10px;" onclick="window.location.href='/admin_panel'">Admin</button>
                <button id="logout-button" style="margin-left: 10px;" onclick="window.location.href='/logout'"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>
    </header>

    <div id="radio-player-container">
        <audio id="audio-stream" controls preload="none" src="https://uk24freenew.listen2myradio.com/live.mp3?typeportmount=s1_9254_stream_554111378">
            ÎŸ browser ÏƒÎ±Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿ audio.
        </audio>
        
        <div class="radio-metadata">
            <span id="metadata-scroller" class="metadata-text">
                [Metadata Placeholder]
            </span>
        </div>
    </div> 
    
    <div class="container">
        <div id="user-list-panel">
            <h3>Users</h3>
            </div>
        
        <div id="chat-container">
            <div id="chatbox"></div>
        </div>
        
    </div>
    
    <div id="input-area">
        <button id="bold-button" title="Bold (Ctrl+B)"><i class="fas fa-bold"></i></button>
        <button id="italic-button" title="Italic (Ctrl+I)"><i class="fas fa-italic"></i></button>
        <button id="underline-button" title="Underline (Ctrl+U)"><i class="fas fa-underline"></i></button> <button id="url-button" title="Insert Link (URL)"><i class="fas fa-link"></i></button> <button id="gif-button" title="Insert GIF"><i class="fas fa-gift"></i></button> <button id="color-picker-button" title="Text Color"><i class="fas fa-palette"></i></button>
        <input type="color" id="color-input" value="#FFFFFF" style="display: none;">
        <button id="emoticon-button" title="Emoticons"><i class="fas fa-smile"></i></button>
        
        <textarea id="message-input" placeholder="Type your message..." rows="1"></textarea>
        <button id="send-button" title="Send (Enter)"><i class="fas fa-paper-plane"></i></button>
    </div>
    
    <div id="settings-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(20, 20, 20, 0.98); padding:25px; border-radius:10px; z-index:9999; border: 1px solid var(--secondary-accent); box-shadow: 0 0 15px var(--secondary-accent); width: 300px;">
        
        <h3><i class="fas fa-cog"></i> Settings</h3>
        
        <div id="settings-user">
            <h4>Sound Control</h4>
            <div style="margin-bottom: 10px;">
                <label for="volume-control"><i class="fas fa-volume-up"></i> Radio Volume:</label>
                <input type="range" id="volume-control" min="0" max="1" step="0.01" value="0.3" oninput="document.getElementById('audio-stream').volume = this.value;">
                <label style="display: block;"><input type="checkbox" id="toggle-sound"> Enable Chat Sounds (TBD)</label>
            </div>
            
            <h4>Change Avatar (URL)</h4>
            <form id="avatar-url-form" style="display: flex; flex-direction: column;">
                <input type="text" id="avatar-url-input" placeholder="Paste image URL" required style="padding: 8px; margin-bottom: 10px; background-color: #333; color: var(--text-color); border: 1px solid #555;">
                <button type="submit">Set Avatar</button>
            </form>
        </div>
        
        <div id="settings-admin" style="display: none;">
            <hr style="border-color: var(--primary-accent);">
            <h4><i class="fas fa-user-shield"></i> Admin Tools (Red)</h4>
            <button class="admin-tool-button" id="ban-user-button">Ban User (TBD)</button>
            <button class="admin-tool-button" id="change-username-button">Change Username (TBD)</button>
            <button class="admin-tool-button" id="clear-shoutbox-button">Clear Shoutbox (TBD)</button>
        </div>

        <div id="settings-owner" style="display: none;">
            <hr style="border-color: #FFD700;">
            <h4><i class="fas fa-crown"></i> Owner Tools (Gold)</h4>
            <p>Full access is granted through the Admin Panel button.</p>
        </div>
        
        <button onclick="document.getElementById('settings-modal').style.display='none'" style="margin-top: 20px;">Close Settings</button>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const audio = document.getElementById('audio-stream');
            
            if (audio) {
                // ğŸš¨ Î‘Ï…Ï„ÏŒ ÎºÎ¬Î½ÎµÎ¹ Ï„Î¿ preload Ï„Î¿Ï… stream Ï€Î¹Î¿ Î¬Î¼ÎµÏƒÎ¿ ÎºÎ±Î¹ ÏÏ…Î¸Î¼Î¯Î¶ÎµÎ¹ Ï„Î·Î½ Î­Î½Ï„Î±ÏƒÎ·.
                // ÎŸ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€Î±Ï„Î®ÏƒÎµÎ¹ Ï„Î¿ Play Î³Î¹Î± Î½Î± Î±ÎºÎ¿ÏÏƒÎµÎ¹.
                audio.volume = 0.3; 
                audio.load(); // Î•Î¾Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ stream ÎµÎ¯Î½Î±Î¹ Î­Ï„Î¿Î¹Î¼Î¿ Î³Î¹Î± Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®
            }
            
            // --- Î•Î›Î•Î“Î§ÎŸÎ£ Î¡ÎŸÎ›ÎŸÎ¥ Î§Î¡Î—Î£Î¤Î— Î“Î™Î‘ Î¤Î‘ ÎšÎŸÎ¥ÎœÎ Î™Î‘ ---
            const currentUserRole = "{{ user.role }}";
            const adminButton = document.getElementById('admin-button');
            const settingsAdminDiv = document.getElementById('settings-admin');
            const settingsOwnerDiv = document.getElementById('settings-owner');

            if (currentUserRole === 'owner') {
                adminButton.style.display = 'inline-block';
                // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Owner/Admin ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ ÏƒÏ„Î¿ Modal
                if (settingsAdminDiv) settingsAdminDiv.style.display = 'block';
                if (settingsOwnerDiv) settingsOwnerDiv.style.display = 'block';
            } else if (currentUserRole === 'admin') {
                adminButton.style.display = 'inline-block';
                // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î¼ÏŒÎ½Î¿ Admin ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ ÏƒÏ„Î¿ Modal
                if (settingsAdminDiv) settingsAdminDiv.style.display = 'block';
            }
            // --------------------------------------------------------
            
            // ğŸš¨ ÎÎ•ÎŸ: Î›Î¿Î³Î¹ÎºÎ® Î³Î¹Î± Ï„Î¿ Avatar URL Form (ÎŸÎœÎ‘Î”Î‘ 3)
            const avatarUrlForm = document.getElementById('avatar-url-form');
            if (avatarUrlForm) {
                avatarUrlForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const urlInput = document.getElementById('avatar-url-input');
                    const newUrl = urlInput.value.trim();
                    
                    if (newUrl) {
                        try {
                            const response = await fetch('/settings/set_avatar_url', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ avatar_url: newUrl })
                            });
                            const result = await response.json();
                            if (result.success) {
                                alert(result.message);
                                // ÎšÎ»ÎµÎ¯Î½Î¿Ï…Î¼Îµ Ï„Î¿ modal
                                document.getElementById('settings-modal').style.display='none';
                                // ğŸš¨ Î£Î—ÎœÎ•Î™Î©Î£Î—: Î— ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… avatar ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î· Î¸Î± Î³Î¯Î½ÎµÎ¹ ÏƒÏ„Î¿ main.js 
                                // Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… SocketIO event 'user_avatar_updated'.
                            } else {
                                alert('Error: ' + result.message);
                            }
                        } catch (error) {
                            console.error('Fetch error:', error);
                            alert('An error occurred while updating the avatar.');
                        }
                    }
                });
            }
        });
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>