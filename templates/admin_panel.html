<!DOCTYPE html>
<html lang="el">
<body>
    <div class="admin-wrapper">
        <header>
            <h1>Admin Panel</h1>
            <div class="user-info">
                Role: <span id="current_user_role" style="font-weight: 900;">Loading...</span>
            </div>
            <a href="/" class="back-link"><i class="fas fa-chevron-left"></i> Back to Chat</a>
        </header>

        <main class="content-container">
            <section id="settings-tab" class="tab-content active">
                <h2>Global Settings</h2>
                <div id="settings-list">
                    </div>
                <button id="save-settings-btn" class="save-btn"><i class="fas fa-save"></i> Save Settings</button>
            </section>

            <section id="emoticons-tab" class="tab-content">
                <h2>Emoticon Management</h2>
                </section>
            
            <section id="users-tab" class="tab-content">
                <h2>User Management</h2>
                </section>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <script>
        const API_BASE = '/api/v1';
        let currentUserId = null;
        let currentUserRole = null;
        
        // ... (Î›Î¿Î³Î¹ÎºÎ® loadSettings, loadEmoticons, loadUsers, saveSettings, updateEmoticon, deleteEmoticon, updateUserRole, deleteUser) ...
        
        async function loadSettings() {
             // ... (Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ fetch(API_BASE + '/settings')) ...
        }

        async function saveSettings() {
            // ... (Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ fetch(API_BASE + '/settings', { method: 'POST', body: JSON.stringify({ settings: updatedSettingsArray }) })) ...
        }

        async function loadEmoticons() {
            // ... (Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ fetch(API_BASE + '/emoticons')) ...
        }
        
        // ... (ÎŸÎ¹ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€ÎµÏ‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚) ...
        
        document.addEventListener('DOMContentLoaded', async () => {
             // 1. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Login & Role
             try {
                 const response = await fetch('/check_login'); // ÎšÎ±Î»Î¿ÏÎ¼Îµ Ï„Î¿ Î½Î­Î¿ route
                 if (!response.ok) throw new Error('Not logged in or session expired.');
                 
                 const userData = await response.json();
                 currentUserId = userData.id;
                 currentUserRole = userData.role;
                 
                 const roleElement = document.getElementById('current_user_role');
                 roleElement.textContent = currentUserRole.toUpperCase();

                 // ğŸš¨ ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Admin/Owner
                 if (currentUserRole !== 'admin' && currentUserRole !== 'owner') {
                     alert('Access Denied. Redirecting to chat.');
                     window.location.pathname = '/';
                     return;
                 }
              } catch (error) {
                  alert('Authentication Error: Redirecting to login.');
                  window.location.pathname = '/login';
                  return;
              }

              // 2. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½
              await loadSettings();
              
              // 3. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Emoticons
              await loadEmoticons();

              // 4. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï‡ÏÎ·ÏƒÏ„ÏÎ½
              await loadUsers();
              
              // 5. Attach Listeners
              document.getElementById('save-settings-btn').addEventListener('click', saveSettings);
              // ... (Attach listeners for Emoticon/User management buttons) ...
         });
    </script>
</body>
</html>