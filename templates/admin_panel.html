<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Chat Control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* 🚨 NEW FUNKY POP ADMIN THEME */
        :root { 
            --primary-color: #FF0066;      /* Hot Pink/Magenta */
            --secondary-color: #00FFCC;    /* Bright Cyan/Turquoise */
            --background-color: #FFEBEB;   /* Very Pale Pink Background */
            --box-bg: #FFFFFF;             /* White/Light Box Background */
            --border-color: #FF77A9;       /* Medium Pink Border */
            --text-color: #333333;
            --button-color: #FFCC00;      /* Yellow/Gold Accent */
            --shadow-admin: 0 8px 20px rgba(255, 0, 102, 0.5);
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color); 
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--box-bg);
            padding: 30px;
            border-radius: 25px;
            border: 4px solid var(--border-color);
            box-shadow: var(--shadow-admin);
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-shadow: 1px 1px var(--text-color);
        }
        
        h2 {
            color: var(--primary-color);
            border-left: 5px solid var(--secondary-color);
            padding-left: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px dashed var(--border-color);
            border-radius: 15px;
        }
        
        /* Buttons */
        button {
            background-color: var(--button-color);
            color: var(--text-color); 
            border: none;
            border-radius: 12px;
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 10px;
        }
        button:hover {
            background-color: var(--primary-color);
            color: #FFFFFF;
            transform: scale(1.05);
        }
        
        /* Settings Items */
        .setting-item, .user-item, .emoticon-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dotted #ccc;
        }
        
        /* Checkbox Styling */
        input[type="checkbox"] {
            transform: scale(1.5);
            accent-color: var(--secondary-color);
        }

        /* Input Fields */
        input[type="text"], input[type="color"] {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #FFF;
            color: var(--text-color);
        }

        /* Emoticons Table */
        .emoticon-item {
            gap: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 150px; /* Tag, Image URL, Status, Actions */
        }
        .emoticon-header {
            font-weight: bold;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Admin Control Panel</h1>
        <p>Logged in as: <span id="current_user_role">...</span></p>
        <button onclick="window.location.href='/'">Return to Chat</button>

        <div class="section" id="theme-settings-section">
            <h2>🔗 Feature Toggle Control (Chat Buttons)</h2>
            <p>Ενεργοποιήστε/Απενεργοποιήστε τις νέες δυνατότητες του Chat παγκοσμίως.</p>

            <div class="setting-item">
                <label for="toggle-bold"><i class="fas fa-bold"></i> Bold Button ([b])</label>
                <input type="checkbox" id="toggle-bold" data-setting-key="feature_bold">
                <button onclick="saveToggle('feature_bold')">Save</button>
            </div>
            
            <div class="setting-item">
                <label for="toggle-italic"><i class="fas fa-italic"></i> Italic Button ([i])</label>
                <input type="checkbox" id="toggle-italic" data-setting-key="feature_italic">
                <button onclick="saveToggle('feature_italic')">Save</button>
            </div>
            
            <div class="setting-item">
                <label for="toggle-underline"><i class="fas fa-underline"></i> Underline Button ([u])</label>
                <input type="checkbox" id="toggle-underline" data-setting-key="feature_underline">
                <button onclick="saveToggle('feature_underline')">Save</button>
            </div>

            <div class="setting-item">
                <label for="toggle-url"><i class="fas fa-link"></i> Link Button ([url])</label>
                <input type="checkbox" id="toggle-url" data-setting-key="feature_url">
                <button onclick="saveToggle('feature_url')">Save</button>
            </div>
            
            <div class="setting-item">
                <label for="toggle-img"><i class="fas fa-image"></i> GIF/Image Button ([img])</label>
                <input type="checkbox" id="toggle-img" data-setting-key="feature_img">
                <button onclick="saveToggle('feature_img')">Save</button>
            </div>
        </div>
        
        <div class="section">
            <h2><i class="fas fa-smile-wink"></i> Emoticon Management</h2>
            <div class="setting-item">
                <input type="text" id="new-tag" placeholder=":tag:" style="width: 150px;">
                <input type="text" id="new-url" placeholder="Image URL (e.g., /static/emotes/smile.gif)" style="flex-grow: 1; margin: 0 10px;">
                <button onclick="addEmoticon()"><i class="fas fa-plus"></i> Add New</button>
            </div>
            
            <div id="emoticon-list">
                <div class="emoticon-header emoticon-item">
                    <div>Tag</div>
                    <div>Image URL</div>
                    <div>Status</div>
                    <div>Actions</div>
                </div>
                </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-users"></i> User Management</h2>
            <div id="user-list">
                </div>
        </div>

    </div>

    <script>
        let currentUserId = null;
        let currentUserRole = null;
        
        // --- ΡΥΘΜΙΣΕΙΣ (SETTINGS) LOGIC ---
        
        async function saveSetting(key, value) {
            try {
                const response = await fetch('/api/admin/set_setting', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ key, value })
                });
                if (!response.ok) throw new Error('Failed to save setting.');
                console.log(`Setting ${key} saved.`);
            } catch (error) {
                alert(`ERROR: Could not save setting. Check console.`);
                console.error('Error saving setting:', error);
            }
        }

        function saveToggle(key) {
            const checkbox = document.querySelector(`[data-setting-key="${key}"]`);
            // Αποθηκεύουμε ως string 'True' ή 'False'
            const value = checkbox.checked ? 'True' : 'False';
            saveSetting(key, value); 
        }

        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                if (!response.ok) throw new Error('Failed to fetch settings.');
                const settings = await response.json();
                
                // Φόρτωση των τιμών στα checkboxes
                document.querySelectorAll('[data-setting-key]').forEach(input => {
                    const key = input.dataset.settingKey;
                    if (settings.hasOwnProperty(key)) {
                        // Μετατροπή string 'True'/'False' σε boolean
                        input.checked = (settings[key].toString().toLowerCase() === 'true');
                    }
                });
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        // --- EMOTICON LOGIC (Placeholder) ---
        async function loadEmoticons() {
            // Αυτή η συνάρτηση θα φορτώσει τα emoticons από το /api/emoticons/all
            // και θα γεμίσει το #emoticon-list.
            console.log("Emoticons loaded (Placeholder)");
        }
        
        async function addEmoticon() {
            // Αυτή η συνάρτηση θα στείλει τα νέα δεδομένα στο /api/admin/add_emoticon
            console.log("Add Emoticon clicked (Placeholder)");
        }

        async function toggleEmoticon(id) {
            // Αυτή η συνάρτηση θα στείλει το toggle στο /api/admin/toggle_emoticon
            console.log(`Toggle Emoticon ${id} (Placeholder)`);
        }

        // --- USER LOGIC (Placeholder) ---
        async function loadUsers() {
            // Αυτή η συνάρτηση θα φορτώσει τους χρήστες από το /api/users
            // και θα γεμίσει το #user-list.
            console.log("Users loaded (Placeholder)");
        }

        async function toggleUserRole(id, newRole) {
            // Αυτή η συνάρτηση θα στείλει την αλλαγή ρόλου στο /api/admin/set_role
            console.log(`Set User ${id} role to ${newRole} (Placeholder)`);
        }
        
        // --- DOMContentLoaded KΛΗΣΗ ---
        document.addEventListener('DOMContentLoaded', async () => {
             // 1. Έλεγχος ρόλου & ID (Κρατάμε την υπάρχουσα λογική)
             try {
                const response = await fetch('/check_login');
                if (!response.ok) throw new Error('Not logged in or session expired.');
                
                const userData = await response.json();
                currentUserId = userData.id;
                currentUserRole = userData.role;
                document.getElementById('current_user_role').textContent = currentUserRole.toUpperCase();
             } catch (error) {
                 alert('Authentication Error: Redirecting to login.');
                 window.location.href = '/login';
                 return;
             }

             // 2. Φόρτωση ρυθμίσεων (ΝΕΟ)
             await loadSettings();
             
             // 3. Φόρτωση Emoticons
             await loadEmoticons();

             // 4. Φόρτωση χρηστών
             await loadUsers();
        });
    </script>
</body>
</html>